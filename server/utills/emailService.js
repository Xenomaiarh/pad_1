const nodemailer = require("nodemailer");

const transporter = nodemailer.createTransport({
    host: "smtp.gmail.com",
    port: 465,
    secure: true,
    auth: {
        user: process.env.EMAIL_USER,
        pass: process.env.EMAIL_PASS,
    },
});

async function sendOrderNotificationEmail(orderData, recipientEmail) {
    const mailOptions = {
        from: `"UTM-Shop" <${process.env.EMAIL_USER}>`,
        to: recipientEmail,
        subject: `üõí –í–∞—à –∑–∞–∫–∞–∑ #${orderData.id} —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω!`,
        html: `
      <h2>–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –∑–∞–∫–∞–∑!</h2>
      <p>–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, ${orderData.name} ${orderData.lastname}!</p>
      <p>–í–∞—à –∑–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω –∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ: <b>${orderData.status}</b></p>
      <p><strong>–°—É–º–º–∞:</strong> $${orderData.total}</p>
      <p><strong>–î–∞—Ç–∞:</strong> ${orderData.dateTime}</p>
      <hr>
      <p>–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É <b>${orderData.phone}</b> –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π.</p>
      <p>–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã ‚Äî –ø—Ä–æ—Å—Ç–æ –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —ç—Ç–æ –ø–∏—Å—å–º–æ.</p>
    `,
    };

    try {
        await transporter.sendMail(mailOptions);
        console.log(`üì© Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ ${recipientEmail}`);
    } catch (error) {
        console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:", error);
    }
}


module.exports = { sendOrderNotificationEmail };
